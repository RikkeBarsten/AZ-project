(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):t(n.viz=n.viz||{})})(this,function(n){"use strict";function f(n){var i={top:20,right:20,bottom:110,left:40},y=960-i.left-i.right,h=650-i.top-i.bottom,e=d3.scaleOrdinal().range(t),c=d3.scaleBand().range([0,y]).padding(.01),p=d3.scaleBand().padding(.1),l=d3.scaleLinear().range([h,0]),a=d3.select("#fuldtid").append("svg").attr("width",y+i.left+i.right).attr("height",h+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),it=d3.dsvFormat(";"),v=it.parse(n),u,w,b,g,k,nt,r,o;v.forEach(function(n){n.Fuldtid=parseFloat(n.Fuldtid.replace(",","."))});u=d3.nest().key(function(n){return n.Virk}).key(function(n){return n.Gender}).rollup(function(n){return d3.sum(n,function(n){return n.Fuldtid})}).entries(v);console.log("DataVirkByGender: "+JSON.stringify(u));u.sort(function(n,t){return t.values.map(function(n){return n.value}).reduce(function(n,t){return n+t})-n.values.map(function(n){return n.value}).reduce(function(n,t){return n+t})});w=[...new Set(u.map(n=>n.key))];console.log("Groups: "+w);c.domain(w);b=[...new Set(v.map(n=>n.Gender))];console.log("Categories: "+b);p.domain(b).rangeRound([0,c.bandwidth()]);g=u.map(n=>n.values);k=g.reduce(function(n,t){return n.concat(t)});console.log("max fuldtid: "+d3.max(k.map(n=>n.value)));l.domain([0,d3.max(k.map(n=>n.value))]);nt=a.selectAll("group").data(u).enter().append("g").attr("class",function(n){return"group group-"+n.key}).attr("transform",function(n){return"translate("+c(n.key)+",0)"});r=d3.select("#fuldtid").append("div").attr("class","mytooltip");r.append("div").attr("class","gender");r.append("div").attr("class","count");r.append("div").attr("class","percent");o=nt.selectAll("rect").data(function(n){return n.values}).enter().append("rect").attr("class",function(n){return"category category-"+n.key}).attr("x",function(n){return p(n.key)}).attr("y",0).attr("width",p.bandwidth()).attr("height",function(n){return h-l(n.value)}).attr("fill",function(n){return e(n.key)}).attr("data-legend",function(n){return n.key});o.transition().duration(1e3).attr("y",function(n){return l(n.value)});var rt=a.append("g").attr("class","axis").attr("transform","translate(0,"+h+")").call(d3.axisBottom(c)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)").call(s,i.bottom),ut=a.append("g").attr("class","axis").call(d3.axisLeft(l)),f=18,d=4,tt=a.selectAll(".legend").data(e.domain()).enter().append("g").attr("class","legend").attr("transform",function(n,t){var i=f+d,r=i*e.domain().length/2,u=y-f*3,o=t*i-r;return"translate("+u+","+o+")"});tt.append("rect").attr("width",f).attr("height",f).style("fill",e).style("stroke",e);tt.append("text").attr("x",f+d).attr("y",f-d).text(function(n){return n});o.on("mouseover",function(n){var i=d3.sum(v.map(function(n){return n.Fuldtid})),t=Math.round(n.value),u=Math.round(1e3*t/i)/10;r.select(".gender").html(n.key);r.select(".count").html(t+" fuldtidsansatte");r.select(".percent").html(u+"% af regionens fuldtidsansatte");r.style("display","block")});o.on("mousemove",function(){r.style("top",d3.event.layerY+10+"px").style("left",d3.event.layerX+10+"px")});o.on("mouseout",function(){r.style("display","none")})}function e(n){function v(n){var r=t,i;t=n;i=d3.transition().duration(d3.event.altKey?7500:750).tween("zoom",function(){var n=d3.interpolateZoom(a,[t.x,t.y,t.r*2+f]);return function(t){y(n(t))}});i.selectAll("text").filter(function(n){return n.parent===t||this.style.display==="inline"}).style("fill-opacity",function(n){return n.parent===t?1:0}).on("start",function(n){n.parent===t&&(this.style.display="inline")}).on("end",function(n){n.parent!==t&&(this.style.display="none")})}function y(n){var t=r/n[2];a=n;d.attr("transform",function(i){return"translate("+(i.x-n[0])*t+","+(i.y-n[1])*t+")"});k.attr("r",function(n){return n.r*t})}var f=20,s=960,r=s,p=d3.scaleOrdinal().range(u),h=d3.select("#bubble").append("svg").attr("width",s).attr("height",960),e=h.append("g").attr("transform","translate("+r/2+","+r/2+")"),w=d3.pack().size([r-f,r-f]).padding(2),b=d3.dsvFormat(";"),c=b.parse(n),o;c.forEach(function(n){n.Fuldtid=parseFloat(n.Fuldtid.replace(",","."))});o=d3.nest().key(function(n){return n.Virk}).key(function(n){return n.Kat}).key(function(n){return n.Gender}).rollup(function(n){return d3.sum(n,function(n){return n.Fuldtid})}).entries(c);console.log("DataSummed: "+JSON.stringify(o));var i=d3.hierarchy({values:o},function(n){return n.values}).sum(function(n){return n.value}).sort(function(n,t){return t.value-n.value}),t=i,l=w(i).descendants(),a,k=e.selectAll("circle").data(l).enter().append("circle").attr("class",function(n){return n.parent?n.children?"node":"node node--leaf--"+n.data.key:"node node--root"}).style("fill",function(n){return n.children?p(n.depth):null}).on("click",function(n){t!==n&&(v(n),d3.event.stopPropagation())}),g=e.selectAll("text").data(l).enter().append("text").attr("class","label").style("fill-opacity",function(n){return n.parent===i?1:0}).style("display",function(n){return n.parent===i?"inline":"none"}).text(function(n){return n.data.key}),d=e.selectAll("circle,text");h.on("click",function(){v(i)});y([i.x,i.y,i.r*2+f])}function o(n){var t={top:20,right:20,bottom:20,left:150},s=960-t.left-t.right,f=500-t.top-t.bottom,c=d3.scaleOrdinal().range(r),e=d3.scaleLinear().range([0,s]),u=d3.scaleBand().range([f,0]).padding(.1),o=d3.select("#fuldtid-deltid").append("svg").attr("width",s+t.left+t.right).attr("height",f+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")"),l=d3.dsvFormat(";"),h=l.parse(n),i;h.forEach(function(n){n.Antal=+n.Antal});i=d3.nest().key(function(n){return n.Arbejdstid}).rollup(function(n){return d3.sum(n,function(n){return n.Antal})}).entries(h);console.log("DataSummed: "+JSON.stringify(i));i.sort(function(n,t){return n.value-t.value});console.log("DataSummed sorted: "+JSON.stringify(i));u.domain(i.map(function(n){return n.key}));e.domain([0,d3.max(i,function(n){return n.value})]);var a=o.selectAll("rect").data(i).enter().append("rect").attr("y",function(n){return u(n.key)}).attr("x",0).attr("height",u.bandwidth()).attr("width",function(n){return e(n.value)}).attr("fill",function(n){return c(n.key)}),v=o.append("g").attr("class","axis").call(d3.axisLeft(u)),y=o.append("g").attr("transform","translate(0,"+f+")").attr("class","axis").call(d3.axisBottom(e))}function s(n,t){n.each(function(){for(var n=d3.select(this),o=n.text().split(/\s+/).reverse(),r,i=[],s=0,f=n.attr("y"),e=parseFloat(n.attr("dy")),u=n.text(null).append("tspan").attr("x",0).attr("y",f).attr("dy",e+"em");r=o.pop();)i.push(r),u.text(i.join(" ")),u.node().getComputedTextLength()>t&&(i.pop(),u.text(i.join(" ")),i=[r],u=n.append("tspan").attr("x",0).attr("y",f).attr("dy",++s*1.1+e+"em").text(r))})}var t=["#80633b","#0085a1","#94948f","#595959","#f9e300","#fecb00","#fcc860","#fc9e77","#ff6d22","#bd4f19","#e21b23","#a20234","\t#00b092","\t#4bdbc3","#d4df4d","#9c9a00","#005c42","#64bf92","#6fd4e4","#3d7edb"],i=t[0],r=t.slice(0,3).reverse(),u=t.slice(0,4).filter(function(n){return n!=i}).reverse();n.fuldtid=f;n.antal=o;n.bubble=e;Object.defineProperty(n,"__esModule",{value:!0})});