(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):t(n.viz=n.viz||{})})(this,function(n){"use strict";function i(n){var i={top:20,right:20,bottom:110,left:40},w=960-i.left-i.right,o=650-i.top-i.bottom,d=d3.scaleOrdinal().range(t),s=d3.scaleBand().range([0,w]).padding(.01),l=d3.scaleBand().padding(.1),h=d3.scaleLinear().range([o,0]),a=d3.select("#fuldtid").append("svg").attr("width",w+i.left+i.right).attr("height",o+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),g=d3.dsvFormat(";"),c=g.parse(n),u,v,y,b,p,k,r,e,nt,tt;c.forEach(function(n){n.Fuldtid=parseFloat(n.Fuldtid.replace(",","."))});u=d3.nest().key(function(n){return n.Virk}).key(function(n){return n.Gender}).rollup(function(n){return d3.sum(n,function(n){return n.Fuldtid})}).entries(c);console.log("DataVirkByGender: "+JSON.stringify(u));u.sort(function(n,t){return t.values.map(function(n){return n.value}).reduce(function(n,t){return n+t})-n.values.map(function(n){return n.value}).reduce(function(n,t){return n+t})});v=[...new Set(u.map(n=>n.key))];console.log("Groups: "+v);s.domain(v);y=[...new Set(c.map(n=>n.Gender))];console.log("Categories: "+y);l.domain(y).rangeRound([0,s.bandwidth()]);b=u.map(n=>n.values);p=b.reduce(function(n,t){return n.concat(t)});console.log("max fuldtid: "+d3.max(p.map(n=>n.value)));h.domain([0,d3.max(p.map(n=>n.value))]);k=a.selectAll("group").data(u).enter().append("g").attr("class",function(n){return"group group-"+n.key}).attr("transform",function(n){return"translate("+s(n.key)+",0)"});r=d3.select("#fuldtid").append("div").attr("class","mytooltip");r.append("div").attr("class","gender");r.append("div").attr("class","count");r.append("div").attr("class","percent");e=k.selectAll("rect").data(function(n){return n.values}).enter().append("rect").attr("class",function(n){return"category category-"+n.key}).attr("x",function(n){return l(n.key)}).attr("y",0).attr("width",l.bandwidth()).attr("height",function(n){return o-h(n.value)}).attr("fill",function(n){return d(n.key)});e.transition().duration(1e3).attr("y",function(n){return h(n.value)});nt=a.append("g").attr("class","axis").attr("transform","translate(0,"+o+")").call(d3.axisBottom(s)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)").call(f,i.bottom);tt=a.append("g").attr("class","axis").call(d3.axisLeft(h));e.on("mouseover",function(n){var i=d3.sum(c.map(function(n){return n.Fuldtid})),t=Math.round(n.value),u=Math.round(1e3*t/i)/10;r.select(".gender").html(n.key);r.select(".count").html(t+" fuldtidsansatte");r.select(".percent").html(u+"% af regionens fuldtidsansatte");r.style("display","block")});e.on("mousemove",function(){r.style("top",d3.event.layerY+10+"px").style("left",d3.event.layerX+10+"px")});e.on("mouseout",function(){r.style("display","none")})}function r(n){function v(n){var r=i,t;i=n;t=d3.transition().duration(d3.event.altKey?7500:750).tween("zoom",function(){var n=d3.interpolateZoom(a,[i.x,i.y,i.r*2+f]);return function(t){y(n(t))}});t.selectAll("text").filter(function(n){return n.parent===i||this.style.display==="inline"}).style("fill-opacity",function(n){return n.parent===i?1:0}).on("start",function(n){n.parent===i&&(this.style.display="inline")}).on("end",function(n){n.parent!==i&&(this.style.display="none")})}function y(n){var t=u/n[2];a=n;d.attr("transform",function(i){return"translate("+(i.x-n[0])*t+","+(i.y-n[1])*t+")"});k.attr("r",function(n){return n.r*t})}var f=20,s=960,u=s,p=d3.scaleOrdinal().range(t),h=d3.select("#bubble").append("svg").attr("width",s).attr("height",960),e=h.append("g").attr("transform","translate("+u/2+","+u/2+")"),w=d3.pack().size([u-f,u-f]).padding(2),b=d3.dsvFormat(";"),c=b.parse(n),o;c.forEach(function(n){n.Fuldtid=parseFloat(n.Fuldtid.replace(",","."))});o=d3.nest().key(function(n){return n.Virk}).key(function(n){return n.Kat}).key(function(n){return n.Gender}).rollup(function(n){return d3.sum(n,function(n){return n.Fuldtid})}).entries(c);console.log("DataSummed: "+JSON.stringify(o));var r=d3.hierarchy({values:o},function(n){return n.values}).sum(function(n){return n.value}).sort(function(n,t){return t.value-n.value}),i=r,l=w(r).descendants(),a,k=e.selectAll("circle").data(l).enter().append("circle").attr("class",function(n){return n.parent?n.children?"node":"node node--leaf--"+n.data.key:"node node--root"}).style("fill",function(n){return n.children?p(n.depth):null}).on("click",function(n){i!==n&&(v(n),d3.event.stopPropagation())}),g=e.selectAll("text").data(l).enter().append("text").attr("class","label").style("fill-opacity",function(n){return n.parent===r?1:0}).style("display",function(n){return n.parent===r?"inline":"none"}).text(function(n){return n.data.key}),d=e.selectAll("circle,text");h.on("click",function(){v(r)});y([r.x,r.y,r.r*2+f])}function u(n){var i={top:20,right:20,bottom:20,left:150},s=960-i.left-i.right,f=500-i.top-i.bottom,c=d3.scaleOrdinal().range(t),e=d3.scaleLinear().range([0,s]),u=d3.scaleBand().range([f,0]).padding(.1),o=d3.select("#fuldtid-deltid").append("svg").attr("width",s+i.left+i.right).attr("height",f+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),l=d3.dsvFormat(";"),h=l.parse(n),r;h.forEach(function(n){n.Antal=+n.Antal});r=d3.nest().key(function(n){return n.Arbejdstid}).rollup(function(n){return d3.sum(n,function(n){return n.Antal})}).entries(h);console.log("DataSummed: "+JSON.stringify(r));r.sort(function(n,t){return n.value-t.value});console.log("DataSummed sorted: "+JSON.stringify(r));u.domain(r.map(function(n){return n.key}));e.domain([0,d3.max(r,function(n){return n.value})]);var a=o.selectAll("rect").data(r).enter().append("rect").attr("y",function(n){return u(n.key)}).attr("x",0).attr("height",u.bandwidth()).attr("width",function(n){return e(n.value)}).attr("fill",function(n){return c(n.key)}),v=o.append("g").attr("class","axis").call(d3.axisLeft(u)),y=o.append("g").attr("transform","translate(0,"+f+")").attr("class","axis").call(d3.axisBottom(e))}function f(n,t){n.each(function(){for(var n=d3.select(this),o=n.text().split(/\s+/).reverse(),r,i=[],s=0,f=n.attr("y"),e=parseFloat(n.attr("dy")),u=n.text(null).append("tspan").attr("x",0).attr("y",f).attr("dy",e+"em");r=o.pop();)i.push(r),u.text(i.join(" ")),u.node().getComputedTextLength()>t&&(i.pop(),u.text(i.join(" ")),i=[r],u=n.append("tspan").attr("x",0).attr("y",f).attr("dy",++s*1.1+e+"em").text(r))})}var t=["#80633b","#0085a1","#94948f","#595959","#f9e300","#fecb00","#fcc860","#fc9e77","#ff6d22","#bd4f19","#e21b23","#a20234","\t#00b092","\t#4bdbc3","#d4df4d","#9c9a00","#005c42","#64bf92","#6fd4e4","#3d7edb"];n.fuldtid=i;n.antal=u;n.bubble=r;Object.defineProperty(n,"__esModule",{value:!0})});